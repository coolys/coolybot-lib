<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SwaggerAutoConfiguration.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coolybot server-side framework</a> &gt; <a href="index.source.html" class="el_package">io.github.coolys.config.apidoc</a> &gt; <span class="el_source">SwaggerAutoConfiguration.java</span></div><h1>SwaggerAutoConfiguration.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2016-2019 the original author or authors from the Coolybot project.
 *
 * This file is part of the Coolybot project, see https://www.coolybot.tech/
 * for more information.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package io.github.coolys.config.apidoc;

import static io.github.coolys.config.CoolybotConstants.SPRING_PROFILE_SWAGGER;
import static springfox.documentation.builders.PathSelectors.regex;

import java.nio.ByteBuffer;
import java.util.*;
import javax.servlet.Servlet;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.ObjectProvider;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.autoconfigure.AutoConfigureAfter;
import org.springframework.boot.autoconfigure.condition.*;
import org.springframework.context.annotation.*;
import org.springframework.data.domain.Pageable;
import org.springframework.http.ResponseEntity;
import org.springframework.util.StopWatch;
import org.springframework.util.StringUtils;
import org.springframework.web.servlet.DispatcherServlet;

import io.github.coolys.config.CoolybotProperties;
import io.github.coolys.config.apidoc.customizer.CoolybotSwaggerCustomizer;
import io.github.coolys.config.apidoc.customizer.SwaggerCustomizer;
import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration;
import springfox.documentation.schema.AlternateTypeRule;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

/**
 * Springfox Swagger configuration.
 * &lt;p&gt;
 * Warning! When having a lot of REST endpoints, Springfox can become a performance issue.
 * In that case, you can use the &quot;no-swagger&quot; Spring profile, so that this bean is ignored.
 */
@Configuration
@ConditionalOnWebApplication
@ConditionalOnClass({
    ApiInfo.class,
    BeanValidatorPluginsConfiguration.class,
    Servlet.class,
    DispatcherServlet.class
})
@Profile(SPRING_PROFILE_SWAGGER)
@AutoConfigureAfter(CoolybotProperties.class)
@EnableSwagger2
@Import(BeanValidatorPluginsConfiguration.class)
public class SwaggerAutoConfiguration {

    static final String STARTING_MESSAGE = &quot;Starting Swagger&quot;;
    static final String STARTED_MESSAGE = &quot;Started Swagger in {} ms&quot;;
    static final String MANAGEMENT_TITLE_SUFFIX = &quot;Management API&quot;;
    static final String MANAGEMENT_GROUP_NAME = &quot;management&quot;;
    static final String MANAGEMENT_DESCRIPTION = &quot;Management endpoints documentation&quot;;

<span class="fc" id="L78">    private final Logger log = LoggerFactory.getLogger(SwaggerAutoConfiguration.class);</span>

    private final CoolybotProperties.Swagger properties;

<span class="fc" id="L82">    public SwaggerAutoConfiguration(CoolybotProperties jHipsterProperties) {</span>
<span class="fc" id="L83">        this.properties = jHipsterProperties.getSwagger();</span>
<span class="fc" id="L84">    }</span>

    /**
     * Springfox configuration for the API Swagger docs.
     *
     * @param swaggerCustomizers Swagger customizers
     * @param alternateTypeRules alternate type rules
     * @return the Swagger Springfox configuration
     */
    @Bean
    @ConditionalOnMissingBean(name = &quot;swaggerSpringfoxApiDocket&quot;)
    public Docket swaggerSpringfoxApiDocket(List&lt;SwaggerCustomizer&gt; swaggerCustomizers,
        ObjectProvider&lt;AlternateTypeRule[]&gt; alternateTypeRules) {
<span class="fc" id="L97">        log.debug(STARTING_MESSAGE);</span>
<span class="fc" id="L98">        StopWatch watch = new StopWatch();</span>
<span class="fc" id="L99">        watch.start();</span>

<span class="fc" id="L101">        Docket docket = createDocket();</span>

        // Apply all SwaggerCustomizers orderly.
<span class="fc" id="L104">        swaggerCustomizers.forEach(customizer -&gt; customizer.customize(docket));</span>

        // Add all AlternateTypeRules if available in spring bean factory.
        // Also you can add your rules in a customizer bean above.
<span class="fc" id="L108">        Optional.ofNullable(alternateTypeRules.getIfAvailable()).ifPresent(docket::alternateTypeRules);</span>

<span class="fc" id="L110">        watch.stop();</span>
<span class="fc" id="L111">        log.debug(STARTED_MESSAGE, watch.getTotalTimeMillis());</span>
<span class="fc" id="L112">        return docket;</span>
    }

    /**
     * Coolybot Swagger Customizer
     *
     * @return the Swagger Customizer of Coolybot
     */
    @Bean
    public CoolybotSwaggerCustomizer jHipsterSwaggerCustomizer() {
<span class="nc" id="L122">        return new CoolybotSwaggerCustomizer(properties);</span>
    }

    /**
     * Springfox configuration for the management endpoints (actuator) Swagger docs.
     *
     * @param appName               the application name
     * @param managementContextPath the path to access management endpoints
     * @return the Swagger Springfox configuration
     */
    @Bean
    @ConditionalOnClass(name = &quot;org.springframework.boot.actuate.autoconfigure.web.server.ManagementServerProperties&quot;)
    @ConditionalOnProperty(&quot;management.endpoints.web.base-path&quot;)
    @ConditionalOnExpression(&quot;'${management.endpoints.web.base-path}'.length() &gt; 0&quot;)
    @ConditionalOnMissingBean(name = &quot;swaggerSpringfoxManagementDocket&quot;)
    public Docket swaggerSpringfoxManagementDocket(@Value(&quot;${spring.application.name:application}&quot;) String appName,
        @Value(&quot;${management.endpoints.web.base-path}&quot;) String managementContextPath) {

<span class="fc" id="L140">        ApiInfo apiInfo = new ApiInfo(</span>
<span class="fc" id="L141">            StringUtils.capitalize(appName) + &quot; &quot; + MANAGEMENT_TITLE_SUFFIX,</span>
            MANAGEMENT_DESCRIPTION,
<span class="fc" id="L143">            properties.getVersion(),</span>
            &quot;&quot;,
            ApiInfo.DEFAULT_CONTACT,
            &quot;&quot;,
            &quot;&quot;,
            new ArrayList&lt;&gt;()
        );

<span class="fc" id="L151">        return createDocket()</span>
<span class="fc" id="L152">            .apiInfo(apiInfo)</span>
<span class="fc" id="L153">            .useDefaultResponseMessages(properties.isUseDefaultResponseMessages())</span>
<span class="fc" id="L154">            .groupName(MANAGEMENT_GROUP_NAME)</span>
<span class="fc" id="L155">            .host(properties.getHost())</span>
<span class="fc" id="L156">            .protocols(new HashSet&lt;&gt;(Arrays.asList(properties.getProtocols())))</span>
<span class="fc" id="L157">            .forCodeGeneration(true)</span>
<span class="fc" id="L158">            .directModelSubstitute(ByteBuffer.class, String.class)</span>
<span class="fc" id="L159">            .genericModelSubstitutes(ResponseEntity.class)</span>
<span class="fc" id="L160">            .ignoredParameterTypes(Pageable.class)</span>
<span class="fc" id="L161">            .select()</span>
<span class="fc" id="L162">            .paths(regex(managementContextPath + &quot;.*&quot;))</span>
<span class="fc" id="L163">            .build();</span>
    }

    protected Docket createDocket() {
<span class="fc" id="L167">        return new Docket(DocumentationType.SWAGGER_2);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>